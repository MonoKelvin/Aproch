<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Node Widget</title>
    <link rel="stylesheet" href="css/style.default.css">
    <!-- <link rel="stylesheet" href="vendor/bootstrap-4.3.1/css/bootstrap.min.css"> -->
</head>

<body>
    <aproch-flow-view id="fv_1" name="flow view" class="flow-view">
    </aproch-flow-view>
    <div style="position: fixed; left: 30px; top:30px;">
        <button style="padding: 4px 10px; left: 20px; top: 20px;" onclick="addNodeTest('#fv_1');">添加节点</button>
        <!-- <aproch-input-number></aproch-input-number> -->
    </div>

    <script type="text/javascript" src="./vendor/jquery/jquery-3.4.1.min.js"></script>
    <!-- <script type="module" src="./core/AWidget.js"></script> -->
    <!-- <script type="module" src="./core/Aproch.js"></script> -->
    <script type="module">
        // import * as a from './core/TypeConverter.js'
        import {ALabelWidget, AInputNumberWidget} from './core/AWidget.js'
        import {AFlowView, ANode, AConnection, AInterface, APort} from './core/Aproch.js'

        //var FVManager = [];
        const CurrentFV = document.querySelector('#fv_1');

        $(document).ready(function () {
            // 防止按下(F5、Ctrl+R、Ctrl+Shift+R)刷新
            window.onkeydown = function (e) {
                var ev = window.event || e;
                var code = ev.keyCode || ev.which;
                if (code == 82 && (ev.metaKey || ev.ctrlKey)) {
                    return false;
                }
            }
            
            customElements.define('aproch-label-widget', ALabelWidget);
            customElements.define('aproch-input-number', AInputNumberWidget);
            customElements.define('aproch-flow-view', AFlowView);
            customElements.define('aproch-node', ANode);
            customElements.define('aproch-interface', AInterface);
            customElements.define('aproch-port', APort);
            customElements.define('aproch-connection', AConnection);
    
            addNodeTest('#fv_1', 100, 100);
            addNodeTest('#fv_1', 500, 100);
        });

        function addNodeTest(flowView, x = 100, y = 100) {
            flowView = document.querySelector(flowView);
            if (flowView === null || !(flowView instanceof AFlowView)) {
                alert('flowView不是有效的，flowView参数：' + flowView);
                return;
            }

            let node = document.createElement('aproch-node');
            flowView.addNode(node);
            node.setName('My Node');
            node.setPosition(x, y);

            let itf = document.createElement('aproch-interface');
            node.addInterface(itf);
            itf.setPort(true, true);

            let label = new ALabelWidget('aproch-label');
            itf.addWidget(label);

            let itf2 = document.createElement('aproch-interface');
            node.addInterface(itf2);
            itf2.setPort(true, true);

            let input = document.createElement('aproch-input-number');
            itf2.addWidget(input);
            // input.addEventListener('change', function() {});
        }
    </script>
</body>

</html>